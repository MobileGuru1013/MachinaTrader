!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.signalR=t()}(this,function(){"use strict";var W="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function B(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};var r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};function o(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function i(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function p(e){return this instanceof p?(this.v=e,this):new p(e)}var g=Object.freeze({__extends:function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__assign:r,__rest:function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]])}return r},__decorate:function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},__param:function(r,n){return function(e,t){n(e,t,r)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(i,s,a,c){return new(a||(a=Promise))(function(e,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}o((c=c.apply(i,s||[])).next())})},__generator:function(r,n){var o,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__exportStar:function(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])},__values:o,__read:i,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},__await:p,__asyncGenerator:function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=r.apply(e,t||[]),s=[];return o={},n("next"),n("throw"),n("return"),o[Symbol.asyncIterator]=function(){return this},o;function n(n){i[n]&&(o[n]=function(r){return new Promise(function(e,t){1<s.push([n,r,e,t])||a(n,r)})})}function a(e,t){try{(r=i[e](t)).value instanceof p?Promise.resolve(r.value.v).then(c,u):l(s[0][2],r)}catch(e){l(s[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},__asyncDelegator:function(n){var e,o;return e={},t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){n[t]&&(e[t]=function(e){return(o=!o)?{value:p(n[t](e)),done:"return"===t}:r?r(e):e})}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):o(e)},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}}}),c=(t(function(e,t){e.exports=function(){function u(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,o=void 0,i=void 0,a=function(e,t){h[n]=e,h[n+1]=t,2===(n+=2)&&(i?i(g):b())},e="undefined"!=typeof window?window:void 0,t=e||{},s=t.MutationObserver||t.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(g,1)}}var h=new Array(1e3);function g(){for(var e=0;e<n;e+=2){var t=h[e],r=h[e+1];t(r),h[e]=void 0,h[e+1]=void 0}n=0}var f,d,v,y,b=void 0;function m(e,t){var r=this,n=new this.constructor(T);void 0===n[_]&&N(n);var o=r._state;if(o){var i=arguments[o-1];a(function(){return R(o,n,i,r._result)})}else j(r,n,e,t);return n}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(T);return I(t,e),t}c?b=function(){return process.nextTick(g)}:s?(d=0,v=new s(g),y=document.createTextNode(""),v.observe(y,{characterData:!0}),b=function(){y.data=d=++d%2}):l?((f=new MessageChannel).port1.onmessage=g,b=function(){return f.port2.postMessage(0)}):b=void 0===e?function(){try{var e=B,t=e("vertx");return void 0!==(o=t.runOnLoop||t.runOnContext)?function(){o(g)}:p()}catch(e){return p()}}():p();var _=Math.random().toString(36).substring(16);function T(){}var L=void 0,S=1,C=2,E=new A;function k(e){try{return e.then}catch(e){return E.error=e,E}}function P(e,t,r){var n,o,i,s;t.constructor===e.constructor&&r===m&&t.constructor.resolve===w?(i=e,(s=t)._state===S?H(i,s._result):s._state===C?O(i,s._result):j(s,void 0,function(e){return I(i,e)},function(e){return O(i,e)})):r===E?(O(e,E.error),E.error=null):void 0===r?H(e,t):u(r)?(n=t,o=r,a(function(t){var r=!1,e=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(o,n,function(e){r||(r=!0,n!==e?I(t,e):H(t,e))},function(e){r||(r=!0,O(t,e))},t._label);!r&&e&&(r=!0,O(t,e))},e)):H(e,t)}function I(e,t){var r,n;e===t?O(e,new TypeError("You cannot resolve a promise with itself")):(n=typeof(r=t),null===r||"object"!==n&&"function"!==n?H(e,t):P(e,t,k(t)))}function M(e){e._onerror&&e._onerror(e._result),x(e)}function H(e,t){e._state===L&&(e._result=t,e._state=S,0!==e._subscribers.length&&a(x,e))}function O(e,t){e._state===L&&(e._state=C,e._result=t,a(M,e))}function j(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+S]=r,o[i+C]=n,0===i&&e._state&&a(x,e)}function x(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)n=t[s],o=t[s+r],n?R(r,n,o,i):o(i);e._subscribers.length=0}}function A(){this.error=null}var F=new A;function R(e,t,r,n){var o=u(r),i=void 0,s=void 0,a=void 0,c=void 0;if(o){if((i=function(e,t){try{return e(t)}catch(e){return F.error=e,F}}(r,n))===F?(c=!0,s=i.error,i.error=null):a=!0,t===i)return void O(t,new TypeError("A promises callback cannot return that same promise."))}else i=n,a=!0;t._state!==L||(o&&a?I(t,i):c?O(t,s):e===S?H(t,i):e===C&&O(t,i))}var D=0;function N(e){e[_]=D++,e._state=void 0,e._result=void 0,e._subscribers=[]}var q=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(T),this.promise[_]||N(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?H(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&H(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===L&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===w){var o=k(t);if(o===m&&t._state!==L)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(r===U){var i=new r(T);P(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===L&&(this._remaining--,e===C?O(n,r):this._result[t]=r),0===this._remaining&&H(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;j(e,void 0,function(e){return r._settledAt(S,t,e)},function(e){return r._settledAt(C,t,e)})},e}(),U=function(){function t(e){this[_]=D++,this._result=this._state=void 0,this._subscribers=[],T!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){I(t,e)},function(e){O(t,e)})}catch(e){O(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})},t}();return U.prototype.then=m,U.all=function(e){return new q(this,e).promise},U.race=function(o){var i=this;return r(o)?new i(function(e,t){for(var r=o.length,n=0;n<r;n++)i.resolve(o[n]).then(e,t)}):new i(function(e,t){return t(new TypeError("You must pass an array to race."))})},U.resolve=w,U.reject=function(e){var t=new this(T);return O(t,e),t},U._setScheduler=function(e){i=e},U._setAsap=function(e){a=e},U._asap=a,U.polyfill=function(){var e=void 0;if(void 0!==W)e=W;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=U},(U.Promise=U).polyfill(),U}()}),t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(o){function e(e,t){var r=this,n=this.constructor.prototype;return(r=o.call(this,e)||this).statusCode=t,r.__proto__=n,r}return g.__extends(e,o),e}(Error);t.HttpError=r;var n=function(n){function e(e){void 0===e&&(e="A timeout occurred.");var t=this,r=this.constructor.prototype;return(t=n.call(this,e)||this).__proto__=r,t}return g.__extends(e,n),e}(Error);t.TimeoutError=n}));e(c);c.HttpError,c.TimeoutError;var f=t(function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.LogLevel||(t.LogLevel={}))[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None"});e(f);f.LogLevel;var s=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,r){this.statusCode=e,this.statusText=t,this.content=r};t.HttpResponse=i;var r=function(){function e(){}return e.prototype.get=function(e,t){return this.send(g.__assign({},t,{method:"GET",url:e}))},e.prototype.post=function(e,t){return this.send(g.__assign({},t,{method:"POST",url:e}))},e.prototype.delete=function(e,t){return this.send(g.__assign({},t,{method:"DELETE",url:e}))},e}(),n=function(r){function e(e){var t=r.call(this)||this;return t.logger=e,t}return g.__extends(e,r),e.prototype.send=function(n){var o=this;return new Promise(function(e,t){var r=new XMLHttpRequest;r.open(n.method,n.url,!0),r.withCredentials=!0,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.headers&&Object.keys(n.headers).forEach(function(e){return r.setRequestHeader(e,n.headers[e])}),n.responseType&&(r.responseType=n.responseType),n.abortSignal&&(n.abortSignal.onabort=function(){r.abort()}),n.timeout&&(r.timeout=n.timeout),r.onload=function(){n.abortSignal&&(n.abortSignal.onabort=null),200<=r.status&&r.status<300?e(new i(r.status,r.statusText,r.response||r.responseText)):t(new c.HttpError(r.statusText,r.status))},r.onerror=function(){o.logger.log(f.LogLevel.Warning,"Error from HTTP request. "+r.status+": "+r.statusText),t(new c.HttpError(r.statusText,r.status))},r.ontimeout=function(){o.logger.log(f.LogLevel.Warning,"Timeout from HTTP request."),t(new c.TimeoutError)},r.send(n.content||"")})},e}(t.HttpClient=r);t.DefaultHttpClient=n});e(s);s.HttpResponse,s.HttpClient,s.DefaultHttpClient;var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function r(){}return r.write=function(e){return""+e+r.RecordSeparator},r.parse=function(e){if(e[e.length-1]!==r.RecordSeparator)throw new Error("Message is incomplete.");var t=e.split(r.RecordSeparator);return t.pop(),t},r.RecordSeparatorCode=30,r.RecordSeparator=String.fromCharCode(r.RecordSeparatorCode),r}();t.TextMessageFormat=r});e(u);u.TextMessageFormat;var a=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.writeHandshakeRequest=function(e){return u.TextMessageFormat.write(JSON.stringify(e))},e.prototype.parseHandshakeResponse=function(e){var t,r;if(e instanceof ArrayBuffer){var n=new Uint8Array(e);if(-1===(i=n.indexOf(u.TextMessageFormat.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=i+1;t=String.fromCharCode.apply(null,n.slice(0,o)),r=n.byteLength>o?n.slice(o).buffer:null}else{var i,s=e;if(-1===(i=s.indexOf(u.TextMessageFormat.RecordSeparator)))throw new Error("Message is incomplete.");o=i+1;t=s.substring(0,o),r=s.length>o?s.substring(o):null}var a=u.TextMessageFormat.parse(t);return[r,JSON.parse(a[0])]},e}();t.HandshakeProtocol=r});e(a);a.HandshakeProtocol;var l=t(function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.MessageType||(t.MessageType={}))[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close"});e(l);l.MessageType;var d=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.log=function(e,t){},e.instance=new e,e}();t.NullLogger=r});e(d);d.NullLogger;var h=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.isRequired=function(e,t){if(null==e)throw new Error("The '"+t+"' argument is required.")},e.isIn=function(e,t,r){if(!(e in t))throw new Error("Unknown "+r+" value: "+e+".")},e}();function h(e,t){var r=null;return e instanceof ArrayBuffer?(r="Binary data of length "+e.byteLength,t&&(r+=". Content: '"+n(e)+"'")):"string"==typeof e&&(r="String data of length "+e.length,t&&(r+=". Content: '"+e+"'.")),r}function n(e){var t=new Uint8Array(e),r="";return t.forEach(function(e){r+="0x"+(e<16?"0":"")+e.toString(16)+" "}),r.substr(0,r.length-1)}t.Arg=r,t.getDataDetail=h,t.formatArrayBuffer=n,t.sendMessage=function(i,s,a,c,u,l,p){return g.__awaiter(this,void 0,void 0,function(){var t,r,n,o;return g.__generator(this,function(e){switch(e.label){case 0:return[4,u()];case 1:return(r=e.sent())&&((o={}).Authorization="Bearer "+r,t=o),i.log(f.LogLevel.Trace,"("+s+" transport) sending data. "+h(l,p)+"."),[4,a.post(c,{content:l,headers:t})];case 2:return n=e.sent(),i.log(f.LogLevel.Trace,"("+s+" transport) request complete. Response status: "+n.statusCode+"."),[2]}})})},t.createLogger=function(e){return void 0===e?new s(f.LogLevel.Information):null===e?d.NullLogger.instance:e.log?e:new s(e)};var o=function(){function e(e){this.observers=[],this.cancelCallback=e}return e.prototype.next=function(e){for(var t=0,r=this.observers;t<r.length;t++){r[t].next(e)}},e.prototype.error=function(e){for(var t=0,r=this.observers;t<r.length;t++){var n=r[t];n.error&&n.error(e)}},e.prototype.complete=function(){for(var e=0,t=this.observers;e<t.length;e++){var r=t[e];r.complete&&r.complete()}},e.prototype.subscribe=function(e){return this.observers.push(e),new i(this,e)},e}();t.Subject=o;var i=function(){function e(e,t){this.subject=e,this.observer=t}return e.prototype.dispose=function(){var e=this.subject.observers.indexOf(this.observer);-1<e&&this.subject.observers.splice(e,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(e){})},e}();t.SubjectSubscription=i;var s=function(){function e(e){this.minimumLogLevel=e}return e.prototype.log=function(e,t){if(e>=this.minimumLogLevel)switch(e){case f.LogLevel.Critical:case f.LogLevel.Error:console.error(f.LogLevel[e]+": "+t);break;case f.LogLevel.Warning:console.warn(f.LogLevel[e]+": "+t);break;case f.LogLevel.Information:console.info(f.LogLevel[e]+": "+t);break;default:console.log(f.LogLevel[e]+": "+t)}},e}();t.ConsoleLogger=s});e(h);h.Arg,h.getDataDetail,h.formatArrayBuffer,h.sendMessage,h.createLogger,h.Subject,h.SubjectSubscription,h.ConsoleLogger;var v=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function n(e,t,r){var n=this;h.Arg.isRequired(e,"connection"),h.Arg.isRequired(t,"logger"),h.Arg.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.logger=t,this.protocol=r,this.connection=e,this.handshakeProtocol=new a.HandshakeProtocol,this.connection.onreceive=function(e){return n.processIncomingData(e)},this.connection.onclose=function(e){return n.connectionClosed(e)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.id=0}return n.create=function(e,t,r){return new n(e,t,r)},n.prototype.start=function(){return g.__awaiter(this,void 0,void 0,function(){var t;return g.__generator(this,function(e){switch(e.label){case 0:return t={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(f.LogLevel.Debug,"Starting HubConnection."),this.receivedHandshakeResponse=!1,[4,this.connection.start(this.protocol.transferFormat)];case 1:return e.sent(),this.logger.log(f.LogLevel.Debug,"Sending handshake request."),[4,this.connection.send(this.handshakeProtocol.writeHandshakeRequest(t))];case 2:return e.sent(),this.logger.log(f.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.configureTimeout(),[2]}})})},n.prototype.stop=function(){return this.logger.log(f.LogLevel.Debug,"Stopping HubConnection."),this.cleanupTimeout(),this.connection.stop()},n.prototype.stream=function(e){for(var r=this,t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.createStreamInvocation(e,t),i=new h.Subject(function(){var e=r.createCancelInvocation(o.invocationId),t=r.protocol.writeMessage(e);return delete r.callbacks[o.invocationId],r.connection.send(t)});this.callbacks[o.invocationId]=function(e,t){t?i.error(t):e.type===l.MessageType.Completion?e.error?i.error(new Error(e.error)):i.complete():i.next(e.item)};var s=this.protocol.writeMessage(o);return this.connection.send(s).catch(function(e){i.error(e),delete r.callbacks[o.invocationId]}),i},n.prototype.send=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.createInvocation(e,t,!0),o=this.protocol.writeMessage(n);return this.connection.send(o)},n.prototype.invoke=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=this.createInvocation(e,r,!1);return new Promise(function(n,o){t.callbacks[i.invocationId]=function(e,t){if(t)o(t);else if(e.type===l.MessageType.Completion){var r=e;r.error?o(new Error(r.error)):n(r.result)}else o(new Error("Unexpected message type: "+e.type))};var e=t.protocol.writeMessage(i);t.connection.send(e).catch(function(e){o(e),delete t.callbacks[i.invocationId]})})},n.prototype.on=function(e,t){e&&t&&(e=e.toLowerCase(),this.methods[e]||(this.methods[e]=[]),-1===this.methods[e].indexOf(t)&&this.methods[e].push(t))},n.prototype.off=function(e,t){if(e){e=e.toLowerCase();var r=this.methods[e];if(r)if(t){var n=r.indexOf(t);-1!==n&&(r.splice(n,1),0===r.length&&delete this.methods[e])}else delete this.methods[e]}},n.prototype.onclose=function(e){e&&this.closedCallbacks.push(e)},n.prototype.processIncomingData=function(e){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(e=this.processHandshakeResponse(e),this.receivedHandshakeResponse=!0),e)for(var t=0,r=this.protocol.parseMessages(e,this.logger);t<r.length;t++){var n=r[t];switch(n.type){case l.MessageType.Invocation:this.invokeClientMethod(n);break;case l.MessageType.StreamItem:case l.MessageType.Completion:var o=this.callbacks[n.invocationId];null!=o&&(n.type===l.MessageType.Completion&&delete this.callbacks[n.invocationId],o(n));break;case l.MessageType.Ping:break;case l.MessageType.Close:this.logger.log(f.LogLevel.Information,"Close message received from server."),this.connection.stop(n.error?new Error("Server returned an error on close: "+n.error):null);break;default:this.logger.log(f.LogLevel.Warning,"Invalid message type: "+n.type)}}this.configureTimeout()},n.prototype.processHandshakeResponse=function(e){var t,r,n;try{r=(n=this.handshakeProtocol.parseHandshakeResponse(e))[0],t=n[1]}catch(e){var o="Error parsing handshake response: "+e;this.logger.log(f.LogLevel.Error,o);var i=new Error(o);throw this.connection.stop(i),i}if(t.error){o="Server returned handshake error: "+t.error;this.logger.log(f.LogLevel.Error,o),this.connection.stop(new Error(o))}else this.logger.log(f.LogLevel.Debug,"Server handshake complete.");return r},n.prototype.configureTimeout=function(){var e=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return e.serverTimeout()},this.serverTimeoutInMilliseconds))},n.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},n.prototype.invokeClientMethod=function(t){var r=this,e=this.methods[t.target.toLowerCase()];if(e){if(e.forEach(function(e){return e.apply(r,t.arguments)}),t.invocationId){var n="Server requested a response, which is not supported in this version of the client.";this.logger.log(f.LogLevel.Error,n),this.connection.stop(new Error(n))}}else this.logger.log(f.LogLevel.Warning,"No client method with the name '"+t.target+"' found.")},n.prototype.connectionClosed=function(t){var r=this,n=this.callbacks;this.callbacks={},Object.keys(n).forEach(function(e){(0,n[e])(void 0,t||new Error("Invocation canceled due to connection being closed."))}),this.cleanupTimeout(),this.closedCallbacks.forEach(function(e){return e.apply(r,[t])})},n.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},n.prototype.createInvocation=function(e,t,r){if(r)return{arguments:t,target:e,type:l.MessageType.Invocation};var n=this.id;return this.id++,{arguments:t,invocationId:n.toString(),target:e,type:l.MessageType.Invocation}},n.prototype.createStreamInvocation=function(e,t){var r=this.id;return this.id++,{arguments:t,invocationId:r.toString(),target:e,type:l.MessageType.StreamInvocation}},n.prototype.createCancelInvocation=function(e){return{invocationId:e,type:l.MessageType.CancelInvocation}},n}();t.HubConnection=r});e(v);v.HubConnection;var y=t(function(e,t){var r,n;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.HttpTransportType||(t.HttpTransportType={}))[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling",(n=t.TransferFormat||(t.TransferFormat={}))[n.Text=1]="Text",n[n.Binary=2]="Binary"});e(y);y.HttpTransportType,y.TransferFormat;var b=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isAborted=!1}return e.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(e.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),e}();t.AbortController=r});e(b);b.AbortController;var m=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,o){this.httpClient=e,this.accessTokenFactory=t||function(){return null},this.logger=r,this.pollAbort=new b.AbortController,this.logMessageContent=n,this.shutdownTimeout=o||5e3}return Object.defineProperty(e.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),e.prototype.connect=function(s,a){return g.__awaiter(this,void 0,void 0,function(){var t,r,n,o,i;return g.__generator(this,function(e){switch(e.label){case 0:if(h.Arg.isRequired(s,"url"),h.Arg.isRequired(a,"transferFormat"),h.Arg.isIn(a,y.TransferFormat,"transferFormat"),this.url=s,this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Connecting"),a===y.TransferFormat.Binary&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return t={abortSignal:this.pollAbort.signal,headers:{},timeout:9e4},a===y.TransferFormat.Binary&&(t.responseType="arraybuffer"),[4,this.accessTokenFactory()];case 1:return r=e.sent(),this.updateHeaderToken(t,r),o=s+"&_="+Date.now(),this.logger.log(f.LogLevel.Trace,"(LongPolling transport) polling: "+o),[4,this.httpClient.get(o,t)];case 2:return 200!==(i=e.sent()).statusCode?(this.logger.log(f.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode),n=new c.HttpError(i.statusText,i.statusCode),this.running=!1):this.running=!0,this.poll(this.url,t,n),[2,Promise.resolve()]}})})},e.prototype.updateHeaderToken=function(e,t){t?e.headers.Authorization="Bearer "+t:e.headers.Authorization&&delete e.headers.Authorization},e.prototype.poll=function(i,s,a){return g.__awaiter(this,void 0,void 0,function(){var t,r,n,o;return g.__generator(this,function(e){switch(e.label){case 0:e.trys.push([0,,8,9]),e.label=1;case 1:return this.running?[4,this.accessTokenFactory()]:[3,7];case 2:t=e.sent(),this.updateHeaderToken(s,t),e.label=3;case 3:return e.trys.push([3,5,,6]),r=i+"&_="+Date.now(),this.logger.log(f.LogLevel.Trace,"(LongPolling transport) polling: "+r),[4,this.httpClient.get(r,s)];case 4:return 204===(n=e.sent()).statusCode?(this.logger.log(f.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.running=!1):200!==n.statusCode?(this.logger.log(f.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+n.statusCode),a=new c.HttpError(n.statusText,n.statusCode),this.running=!1):n.content?(this.logger.log(f.LogLevel.Trace,"(LongPolling transport) data received. "+h.getDataDetail(n.content,this.logMessageContent)),this.onreceive&&this.onreceive(n.content)):this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return o=e.sent(),this.running?o instanceof c.TimeoutError?this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(a=o,this.running=!1):this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: "+o.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.stopped=!0,this.shutdownTimer&&clearTimeout(this.shutdownTimer),this.onclose&&(this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Firing onclose event. Error: "+(a||"<undefined>")),this.onclose(a)),this.logger.log(f.LogLevel.Trace,"(LongPolling transport) Transport finished."),[7];case 9:return[2]}})})},e.prototype.send=function(t){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return this.running?[2,h.sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},e.prototype.stop=function(){return g.__awaiter(this,void 0,void 0,function(){var t,r,n=this;return g.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,,3,4]),this.running=!1,this.logger.log(f.LogLevel.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.accessTokenFactory()];case 1:return r=e.sent(),this.updateHeaderToken(t,r),[4,this.httpClient.delete(this.url,t)];case 2:return e.sent(),this.logger.log(f.LogLevel.Trace,"(LongPolling transport) DELETE request accepted."),[3,4];case 3:return this.stopped||(this.shutdownTimer=setTimeout(function(){n.logger.log(f.LogLevel.Warning,"(LongPolling transport) server did not terminate after DELETE request, canceling poll."),n.pollAbort.abort()},this.shutdownTimeout)),[7];case 4:return[2]}})})},e}();t.LongPollingTransport=r});e(m);m.LongPollingTransport;var w=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){this.httpClient=e,this.accessTokenFactory=t||function(){return null},this.logger=r,this.logMessageContent=n}return e.prototype.connect=function(i,s){return g.__awaiter(this,void 0,void 0,function(){var t,o=this;return g.__generator(this,function(e){switch(e.label){case 0:if(h.Arg.isRequired(i,"url"),h.Arg.isRequired(s,"transferFormat"),h.Arg.isIn(s,y.TransferFormat,"transferFormat"),"undefined"==typeof EventSource)throw new Error("'EventSource' is not supported in your environment.");return this.logger.log(f.LogLevel.Trace,"(SSE transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(t=e.sent())&&(i+=(i.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),this.url=i,[2,new Promise(function(e,r){var n=!1;s!==y.TransferFormat.Text&&r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));var t=new EventSource(i,{withCredentials:!0});try{t.onmessage=function(e){if(o.onreceive)try{o.logger.log(f.LogLevel.Trace,"(SSE transport) data received. "+h.getDataDetail(e.data,o.logMessageContent)+"."),o.onreceive(e.data)}catch(e){return void(o.onclose&&o.onclose(e))}},t.onerror=function(e){var t=new Error(e.message||"Error occurred");n?o.close(t):r(t)},t.onopen=function(){o.logger.log(f.LogLevel.Information,"SSE connected to "+o.url),o.eventSource=t,n=!0,e()}}catch(e){return Promise.reject(e)}})]}})})},e.prototype.send=function(t){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return this.eventSource?[2,h.sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},e.prototype.stop=function(){return this.close(),Promise.resolve()},e.prototype.close=function(e){this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.onclose&&this.onclose(e))},e}();t.ServerSentEventsTransport=r});e(w);w.ServerSentEventsTransport;var _=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.logger=t,this.accessTokenFactory=e||function(){return null},this.logMessageContent=r}return e.prototype.connect=function(i,s){return g.__awaiter(this,void 0,void 0,function(){var t,o=this;return g.__generator(this,function(e){switch(e.label){case 0:if(h.Arg.isRequired(i,"url"),h.Arg.isRequired(s,"transferFormat"),h.Arg.isIn(s,y.TransferFormat,"transferFormat"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(f.LogLevel.Trace,"(WebSockets transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(t=e.sent())&&(i+=(i.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),[2,new Promise(function(t,r){i=i.replace(/^http/,"ws");var n=new WebSocket(i);s===y.TransferFormat.Binary&&(n.binaryType="arraybuffer"),n.onopen=function(e){o.logger.log(f.LogLevel.Information,"WebSocket connected to "+i),o.webSocket=n,t()},n.onerror=function(e){r(e.error)},n.onmessage=function(e){o.logger.log(f.LogLevel.Trace,"(WebSockets transport) data received. "+h.getDataDetail(e.data,o.logMessageContent)+"."),o.onreceive&&o.onreceive(e.data)},n.onclose=function(e){o.logger.log(f.LogLevel.Trace,"(WebSockets transport) socket closed."),o.onclose&&(!1===e.wasClean||1e3!==e.code?o.onclose(new Error("Websocket closed with status code: "+e.code+" ("+e.reason+")")):o.onclose())}})]}})})},e.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(f.LogLevel.Trace,"(WebSockets transport) sending data. "+h.getDataDetail(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},e.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},e}();t.WebSocketTransport=r});e(_);_.WebSocketTransport;var T=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t={}),this.features={},h.Arg.isRequired(e,"url"),this.logger=h.createLogger(t.logger),this.baseUrl=this.resolveUrl(e),(t=t||{}).accessTokenFactory=t.accessTokenFactory||function(){return null},t.logMessageContent=t.logMessageContent||!1,this.httpClient=t.httpClient||new s.DefaultHttpClient(this.logger),this.connectionState=2,this.options=t}return e.prototype.start=function(e){return e=e||y.TransferFormat.Binary,h.Arg.isIn(e,y.TransferFormat,"transferFormat"),this.logger.log(f.LogLevel.Debug,"Starting connection with transfer format '"+y.TransferFormat[e]+"'."),2!==this.connectionState?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(e),this.startPromise)},e.prototype.send=function(e){if(1!==this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(e)},e.prototype.stop=function(t){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){switch(e.label){case 0:this.connectionState=2,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startPromise];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:return this.transport?(this.stopError=t,[4,this.transport.stop()]):[3,6];case 5:e.sent(),this.transport=null,e.label=6;case 6:return[2]}})})},e.prototype.startInternal=function(u){return g.__awaiter(this,void 0,void 0,function(){var r,n,o,t,i,s,a,c=this;return g.__generator(this,function(e){switch(e.label){case 0:r=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,e.label=1;case 1:return e.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==y.HttpTransportType.WebSockets?[3,3]:(this.transport=this.constructTransport(y.HttpTransportType.WebSockets),[4,this.transport.connect(r,u)]):[3,5];case 2:return e.sent(),[3,4];case 3:throw Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,o=0,t=function(){var t;return g.__generator(this,function(e){switch(e.label){case 0:return[4,i.getNegotiationResponse(r)];case 1:return n=e.sent(),2===i.connectionState?[2,{value:void 0}]:(n.url&&(r=n.url),n.accessToken&&(t=n.accessToken,i.accessTokenFactory=function(){return t}),o++,[2])}})},i=this,e.label=6;case 6:return[5,t()];case 7:if("object"==typeof(s=e.sent()))return[2,s.value];e.label=8;case 8:if(n.url&&o<100)return[3,6];e.label=9;case 9:if(100===o&&n.url)throw Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(r,this.options.transport,n,u)];case 10:e.sent(),e.label=11;case 11:return this.transport instanceof m.LongPollingTransport&&(this.features.inherentKeepAlive=!0),this.transport.onreceive=this.onreceive,this.transport.onclose=function(e){return c.stopConnection(e)},this.changeState(0,1),[3,13];case 12:throw a=e.sent(),this.logger.log(f.LogLevel.Error,"Failed to start the connection: "+a),this.connectionState=2,this.transport=null,a;case 13:return[2]}})})},e.prototype.getNegotiationResponse=function(a){return g.__awaiter(this,void 0,void 0,function(){var t,r,n,o,i,s;return g.__generator(this,function(e){switch(e.label){case 0:return[4,this.accessTokenFactory()];case 1:(t=e.sent())&&((s={}).Authorization="Bearer "+t,r=s),n=this.resolveNegotiateUrl(a),this.logger.log(f.LogLevel.Debug,"Sending negotiation request: "+n),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.httpClient.post(n,{content:"",headers:r})];case 3:if(200!==(o=e.sent()).statusCode)throw Error("Unexpected status code returned from negotiate "+o.statusCode);return[2,JSON.parse(o.content)];case 4:throw i=e.sent(),this.logger.log(f.LogLevel.Error,"Failed to complete negotiation with the server: "+i),i;case 5:return[2]}})})},e.prototype.createConnectUrl=function(e,t){return e+(-1===e.indexOf("?")?"?":"&")+"id="+t},e.prototype.createTransport=function(c,u,l,p){return g.__awaiter(this,void 0,void 0,function(){var t,r,n,o,i,s,a;return g.__generator(this,function(e){switch(e.label){case 0:return t=this.createConnectUrl(c,l.connectionId),this.isITransport(u)?(this.logger.log(f.LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=u,[4,this.transport.connect(t,p)]):[3,2];case 1:return e.sent(),this.changeState(0,1),[2];case 2:r=l.availableTransports,n=0,o=r,e.label=3;case 3:return n<o.length?(i=o[n],this.connectionState=0,"number"!=typeof(s=this.resolveTransport(i,u,p))?[3,8]:(this.transport=this.constructTransport(s),null!==l.connectionId?[3,5]:[4,this.getNegotiationResponse(c)])):[3,9];case 4:l=e.sent(),t=this.createConnectUrl(c,l.connectionId),e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.transport.connect(t,p)];case 6:return e.sent(),this.changeState(0,1),[2];case 7:return a=e.sent(),this.logger.log(f.LogLevel.Error,"Failed to start the transport '"+y.HttpTransportType[s]+"': "+a),this.connectionState=2,l.connectionId=null,[3,8];case 8:return n++,[3,3];case 9:throw new Error("Unable to initialize any of the available transports.")}})})},e.prototype.constructTransport=function(e){switch(e){case y.HttpTransportType.WebSockets:return new _.WebSocketTransport(this.accessTokenFactory,this.logger,this.options.logMessageContent);case y.HttpTransportType.ServerSentEvents:return new w.ServerSentEventsTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);case y.HttpTransportType.LongPolling:return new m.LongPollingTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);default:throw new Error("Unknown transport: "+e+".")}},e.prototype.resolveTransport=function(e,t,r){var n,o,i=y.HttpTransportType[e.transport];if(null==i)this.logger.log(f.LogLevel.Debug,"Skipping transport '"+e.transport+"' because it is not supported by this client.");else{var s=e.transferFormats.map(function(e){return y.TransferFormat[e]});if(o=i,(n=t)&&0==(o&n))this.logger.log(f.LogLevel.Debug,"Skipping transport '"+y.HttpTransportType[i]+"' because it was disabled by the client.");else if(0<=s.indexOf(r)){if(!(i===y.HttpTransportType.WebSockets&&"undefined"==typeof WebSocket||i===y.HttpTransportType.ServerSentEvents&&"undefined"==typeof EventSource))return this.logger.log(f.LogLevel.Debug,"Selecting transport '"+y.HttpTransportType[i]+"'"),i;this.logger.log(f.LogLevel.Debug,"Skipping transport '"+y.HttpTransportType[i]+"' because it is not supported in your environment.'")}else this.logger.log(f.LogLevel.Debug,"Skipping transport '"+y.HttpTransportType[i]+"' because it does not support the requested transfer format '"+y.TransferFormat[r]+"'.")}return null},e.prototype.isITransport=function(e){return e&&"object"==typeof e&&"connect"in e},e.prototype.changeState=function(e,t){return this.connectionState===e&&(this.connectionState=t,!0)},e.prototype.stopConnection=function(t){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return this.transport=null,(t=this.stopError||t)?this.logger.log(f.LogLevel.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(f.LogLevel.Information,"Connection disconnected."),this.connectionState=2,this.onclose&&this.onclose(t),[2]})})},e.prototype.resolveUrl=function(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+e+"'.");var t=window.document.createElement("a");return t.href=e,this.logger.log(f.LogLevel.Information,"Normalizing '"+e+"' to '"+t.href+"'."),t.href},e.prototype.resolveNegotiateUrl=function(e){var t=e.indexOf("?"),r=e.substring(0,-1===t?e.length:t);return"/"!==r[r.length-1]&&(r+="/"),r+="negotiate",r+=-1===t?"":e.substring(t)},e}();t.HttpConnection=r});e(T);T.HttpConnection;var L=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.name="json",this.version=1,this.transferFormat=y.TransferFormat.Text}return e.prototype.parseMessages=function(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=d.NullLogger.instance);for(var r=[],n=0,o=u.TextMessageFormat.parse(e);n<o.length;n++){var i=o[n],s=JSON.parse(i);if("number"!=typeof s.type)throw new Error("Invalid payload.");switch(s.type){case l.MessageType.Invocation:this.isInvocationMessage(s);break;case l.MessageType.StreamItem:this.isStreamItemMessage(s);break;case l.MessageType.Completion:this.isCompletionMessage(s);break;case l.MessageType.Ping:case l.MessageType.Close:break;default:t.log(f.LogLevel.Information,"Unknown message type '"+s.type+"' ignored.");continue}r.push(s)}return r},e.prototype.writeMessage=function(e){return u.TextMessageFormat.write(JSON.stringify(e))},e.prototype.isInvocationMessage=function(e){this.assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this.assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")},e.prototype.isStreamItemMessage=function(e){if(this.assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")},e.prototype.isCompletionMessage=function(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.assertNotEmptyString(e.error,"Invalid payload for Completion message."),this.assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")},e.prototype.assertNotEmptyString=function(e,t){if("string"!=typeof e||""===e)throw new Error(t)},e}();t.JsonHubProtocol=r});e(L);L.JsonHubProtocol;var S=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.configureLogging=function(e){return h.Arg.isRequired(e,"logging"),void 0!==e.log?this.logger=e:this.logger=new h.ConsoleLogger(e),this},e.prototype.withUrl=function(e,t){return h.Arg.isRequired(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?t:{transport:t},this},e.prototype.withHubProtocol=function(e){return h.Arg.isRequired(e,"protocol"),this.protocol=e,this},e.prototype.build=function(){var e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var t=new T.HttpConnection(this.url,e);return v.HubConnection.create(t,this.logger||d.NullLogger.instance,this.protocol||new L.JsonHubProtocol)},e}();t.HubConnectionBuilder=r});e(S);S.HubConnectionBuilder;var C=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="0.0.0-DEV_BUILD",t.HttpError=c.HttpError,t.TimeoutError=c.TimeoutError,t.DefaultHttpClient=s.DefaultHttpClient,t.HttpClient=s.HttpClient,t.HttpResponse=s.HttpResponse,t.HubConnection=v.HubConnection,t.HubConnectionBuilder=S.HubConnectionBuilder,t.MessageType=l.MessageType,t.LogLevel=f.LogLevel,t.HttpTransportType=y.HttpTransportType,t.TransferFormat=y.TransferFormat,t.NullLogger=d.NullLogger,t.JsonHubProtocol=L.JsonHubProtocol});e(C);C.VERSION,C.HttpError,C.TimeoutError,C.DefaultHttpClient,C.HttpClient,C.HttpResponse,C.HubConnection,C.HubConnectionBuilder,C.MessageType,C.LogLevel,C.HttpTransportType,C.TransferFormat,C.NullLogger,C.JsonHubProtocol;return e(t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),g.__exportStar(C,t)}))});